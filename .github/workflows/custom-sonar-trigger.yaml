name: Sonar Scan (Auto)  # ğŸ§ª Auto SonarQube scan workflow

on:
  pull_request:             # ğŸŸ¢ Triggers on PR creation or update
    branches:
        - main
  workflow_dispatch: {}     # ğŸŸ¢ Allows manual trigger from GitHub UI
  push:
      branches:
        - main

jobs:
  sonar:
    # Centralized multi-language wrapper workflow
    # You donâ€™t need to define build/test/scan logic here â€” handled in the wrapper
    uses: AZU-RDIT/io-sonar-centralized-workflow-wrapper/.github/workflows/sonar-wrapper.yml@stable

    with:
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # ğŸš¦ Classification
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

      repo_type: auto
      # âœ… Required: YES
      # dev â†’ Default for code repos; enables build/test/scan
      # infra â†’ Would disable coverage and treat repo as infra-only
      # auto â†’ Detects based on language detection (not needed here)

      #language: ""
      # âœ… Required for this file: YES (explicit override)
      # Forces the wrapper to treat this repo as Python-only
      # Ensures central logic doesnâ€™t accidentally trigger multi-language mode
      # âš ï¸ Must be consistent with presence of build files like `requirements.txt`, `setup.py`, `pyproject.toml`

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # ğŸ›  Build / Coverage Overrides
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

      #build_command: ""
      # âœ… Optional: YES (default: "")
      # When provided, overrides default Python build logic
      # Useful if using tox, Poetry, or custom paths
      # ğŸ” Example:
      #   "pip install -r requirements.txt && pytest --cov=my_module --cov-report=xml:cov/coverage.xml"
      # âš ï¸ Must ensure a valid Cobertura-style XML (`coverage.xml`) is created
      # ğŸ’¡ If omitted, wrapper runs: `coverage run -m pytest` followed by `coverage xml -o coverage.xml`

      #coverage_report_path: ""
      # âœ… Optional: YES (default: "")
      # Deprecated â€“ wrapper now auto-detects `coverage.xml`
      # Use only if your report is outside standard locations like `./coverage.xml` or `cov/coverage.xml`
      # âš ï¸ This is ignored in most updated wrapper logic unless enforced explicitly

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # ğŸ¯ Sonar Shortcut Properties
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

      #sonar_exclusions: "tests/**"
      # âœ… Optional: YES
      # Globs of files/folders to exclude from analysis
      # Useful to skip test code, generated files, etc.
      # âš ï¸ Exclusion does not affect coverage, only static code analysis
      # ğŸ” Common values: "**/tests/**", "**/__init__.py", "**/*.spec.ts"

      #sonar_inclusions: ""
      # âœ… Optional: YES
      # Globs of files/folders to include explicitly in scan
      # Helpful in monorepos or non-standard folder structures
      # ğŸ” Example: "src/**"

      #extra_sonar_args: ""
      # âœ… Optional: YES
      # Additional raw SonarQube arguments
      # ğŸ” Example: "-Dsonar.verbose=true"
      # âš ï¸ Use carefully. These will override or augment default wrapper-generated arguments.

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # ğŸ· Tuning Options
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

      #search_depth: 6
      # âœ… Optional: YES (default: 8)
      # Controls how deep the wrapper searches for `requirements.txt`, `setup.py`, etc.
      # Reduce for performance on flat repos; increase for nested structures

      #enable_coverage: true
      # âœ… Required: YES (default: true)
      # Enables build/test and coverage reporting
      # false â†’ skips test and coverage; only static analysis is run
      # âš ï¸ Must be `true` for meaningful coverage reporting to SonarQube

    secrets: inherit
    # âœ… Required: YES
    # Inherits repo-level secrets including:
    # - SONAR_TOKEN (must have scan/create permission in SonarQube)
    # - Any custom secrets like PyPI credentials, S3 keys, etc. if used in build